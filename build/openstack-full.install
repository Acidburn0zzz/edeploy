#!/bin/bash
#
# Copyright (C) 2013 eNovance SAS <licensing@enovance.com>
#
# Author: Emilien Macchi <emilien.macchi@enovance.com>
#         Gon√©ri Le Bouder <goneri.lebouder@enovance.com>
#
# Licensed under the Apache License, Version 2.0 (the "License"); you may
# not use this file except in compliance with the License. You may obtain
# a copy of the License at
#
#      http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS, WITHOUT
# WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the
# License for the specific language governing permissions and limitations
# under the License.

src="$1"
dir="$2"
version="$3"
ROLE=openstack-full

ORIG=$(cd $(dirname $0); pwd)

. ${ORIG}/functions

install_ib_if_needed $ORIG $dir

case "$OS" in
    "Debian")
     do_chroot $dir "apt-key adv --recv-keys --keyserver keyserver.ubuntu.com 0xcbcb082a1bb943db"
     cat > ${dir}/etc/apt/sources.list.d/maria.list <<EOF
deb http://ftp.igh.cnrs.fr/pub/mariadb/repo/5.5/debian $DIST main
EOF
     cat > ${dir}/etc/apt/trusted.gpg.d/maria.gpg <<EOF
-----BEGIN PGP PUBLIC KEY BLOCK-----
Version: SKS 1.1.3

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
NIviaUUV7kxMXt949GQX
=+IUZ
-----END PGP PUBLIC KEY BLOCK-----
EOF
    ;;
    "Ubuntu")
     do_chroot $dir "apt-key adv --recv-keys --keyserver keyserver.ubuntu.com 0xcbcb082a1bb943db"
     cat > ${dir}/etc/apt/sources.list.d/maria.list <<EOF
deb [trusted=yes] http://ftp.igh.cnrs.fr/pub/mariadb/repo/5.5/ubuntu $DIST main
EOF
    ;;
    "CentOS"|"RedHatEnterpriseServer")
      if [ "$(get_redhat_major_version $CODENAME)" == "6" ]; then
          cat > ${dir}/etc/yum.repos.d/mariadb.repo <<EOF
# MariaDB 5.5 RedHat repository list - created 2013-12-17 16:18 UTC
# http://mariadb.org/mariadb/repositories/
[mariadb]
name = MariaDB
baseurl = http://yum.mariadb.org/5.5/rhel6-amd64
gpgkey=https://yum.mariadb.org/RPM-GPG-KEY-MariaDB
gpgcheck=1
EOF
            cat > ${dir}/etc/yum.repos.d/mongodb.repo <<EOF
[mongodb]
name=MongoDB Repository
baseurl=http://downloads-distro.mongodb.org/repo/redhat/os/x86_64/
gpgcheck=0
enabled=1
EOF
      fi
      ;;
    *)
        fatal_error "OS ($OS) or Release not supported"
    ;;
esac

if [ "$OS" = Debian ]; then
    headers=linux-headers-3.2.0-4-all-amd64
else
    headers=
fi

declare -A packages
packages=(
    ["deb"]="\
        apache2 \
        build-essential \
        ceilometer-agent-central \
        ceilometer-alarm-evaluator \
        ceilometer-alarm-notifier \
        ceilometer-api \
        ceilometer-collector \
        euca2ools \
        keystone \
        libdbd-mysql-perl \
        $headers \
        mariadb-client \
        mariadb-server \
        mysql-client \
        memcached \
        mongodb-clients \
        mongodb-server \
        neutron-lbaas-agent \
        neutron-metadata-agent \
        neutron-plugin-vpn-agent \
        openstack-dashboard \
        openstack-dashboard-apache \
        openstack-cloud-identity \
        openstack-cloud-services \
        openstack-compute-node \
        openstack-proxy-node \
        openvswitch-datapath-dkms \
        openstack-proxy-node \
        pm-utils \
        rabbitmq-server \
        rsync \
        ruby-activerecord \
        ruby-sqlite3 \
        screen \
        swift-account \
        swift-container \
        swift-object \
        swift-plugin-s3 \
        swift-proxy \
        unzip
        xfsprogs \
        xinetd"

    ["Centos"]="apache2 \
        memcached \
        mariadb-client \
        mariadb-server \
        mongo-10gen \
        mongo-10gen-server \
        mysql-server \
        ntp \
        openstack-ceilometer-agent-central \
        openstack-ceilometer-api \
        openstack-ceilometer-collector \
        openstack-ceilometer-compute \
        openstack-dashboard \
        openstack-keystone \
        openstack-neutron \
        openstack-neutron-openvswitch \
        openstack-nova-compute \
        openstack-swift-account \
        openstack-swift-container \
        openstack-swift-object \
        openstack-swift-proxy \
        puppetdb \
        python-cinderclient \
        qemu-kvm \
        rabbitmq-server \
        rsync \
        ruby-activerecord \
        ruby-sqlite3 \
        xfsprogs \
        xinetd"

    ["RedHatEnterpriseServer"]="
        apache2 \
        mariadb-client \
        mariadb-server \
        memcached \
        mongo-10gen \
        mongo-10gen-server \
        mysql-server \
        ntp \
        openstack-ceilometer-central \
        openstack-ceilometer-api \
        openstack-ceilometer-collector \
        openstack-ceilometer-compute \
        openstack-dashboard \
        openstack-keystone \
        openstack-neutron \
        openstack-neutron-openvswitch \
        openstack-nova-compute \
        openstack-swift-account \
        openstack-swift-container \
        openstack-swift-object \
        openstack-swift-proxy \
        puppetdb \
        python-cinderclient \
        qemu-kvm \
        rabbitmq-server \
        rsync \
        xfsprogs \
        xinetd"
)

# As the openstack repository is part of the rhn, we need to register it again
# edeploy does unregister from rhn between roles at build time
if [ "$OS" = "RedHatEnterpriseServer" ]; then
    add_satellite_channel $dir rhel-x86_64-server-6-ost-beta
fi

update_repositories $dir

case "$OS" in
    "Debian"|"Ubuntu")
        install_packages $dir ${packages["deb"]}

        services="apache2 \
            ceilometer-agent-central \
            ceilometer-agent-compute \
            ceilometer-alarm-evaluator \
            ceilometer-alarm-notifier \
            ceilometer-api \
            ceilometer-collector \
            cloud-config \
            cloud-final \
            glance-api \
            glance-registry \
            heat-api \
            heat-api-cfn \
            heat-api-cloudwatch \
            heat-engine \
            ipmievd \
            keystone \
            libvirt-bin \
            libvirt-guests \
            memcached \
            mongodb \
            mysql \
            neutron-dhcp-agent \
            neutron-l3-agent \
            neutron-plugin-openvswitch-agent \
            neutron-server \
            nova-api \
            nova-cert \
            nova-compute \
            nova-conductor \
            nova-consoleauth \
            nova-novncproxy \
            nova-scheduler \
            nova-spicehtml5proxy \
            nova-xenvncproxy \
            openvswitch-switch \
            rabbitmq-server \
            swift-account \
            swift-account-auditor \
            swift-account-reaper \
            swift-account-replicator \
            swift-container \
            swift-container-auditor \
            swift-container-replicator \
            swift-container-updater \
            swift-object \
            swift-object-auditor \
            swift-object-replicator \
            swift-object-updater \
            swift-proxy \
            xinetd \
            "
    for s in ${services}; do
        do_chroot $dir update-rc.d $s disable
    done
    ;;
    "CentOS"|"RedHatEnterpriseServer")
        install_packages $dir ${packages[$OS]}

        services="cloud-config \
            cloud-final \
            cloud-init \
            cloud-init-local \
            iscsi \
            iscsid \
            libvirtd \
            libvirt-guests \
            memcached \
            mongod \
            mysqld \
            neutron-dhcp-agent \
            neutron-l3-agent \
            neutron-lbaas-agent \
            neutron-metadata-agent \
            neutron-openvswitch-agent \
            neutron-ovs-cleanup \
            neutron-server \
            openstack-ceilometer-api \
            openstack-ceilometer-collector \
            openstack-ceilometer-compute \
            openstack-keystone \
            openstack-nova-compute \
            openstack-swift-account \
            openstack-swift-account-auditor \
            openstack-swift-account-reaper \
            openstack-swift-account-replicator \
            openstack-swift-container \
            openstack-swift-container-auditor \
            openstack-swift-container-replicator \
            openstack-swift-container-updater \
            openstack-swift-object \
            openstack-swift-object-auditor \
            openstack-swift-object-expirer \
            openstack-swift-object-replicator \
            openstack-swift-object-updater \
            openstack-swift-proxy \
            puppetdb \
            rabbitmq-server \
            radvd \
            "
    for s in ${services}; do
        do_chroot $dir chkconfig $s off
    done
    do_chroot $dir chkconfig puppet on
    ;;
    *)
    fatal_error "OS or Release not supported"
    ;;
esac

clear_packages_cache $dir


